# プラグインのAPIの仕様

## Webプラグインの追加手順

- メインHTMLで、wnako3.js を読み込む
  - `navigator.nako3` にコンパイラのインスタンスが作成される
- script src="plugin_xxx.js で独自プラグインを読み込む

## プラグイン側の実装

プラグインの実体は、Object。

```
{ "命令名":{ 定義 }, "命令名": { 定義 } ... }
```

### 定義：関数

```
{
  type:"func", josi: [["を","から"], ["まで"]],
  fn: function(s) { ... }
}
```

### 定義：定数

```
{ type: "const", value: 100 }
```

### プラグインの自動登録

プラグインの末尾に以下のコードを仕込むことによって、scriptタグで読み込んだと同時に、システムに登録することができる。

```
if (typeof(navigator) == "object") {
  navigator.nako3.addPluginObject(プラグイン名, オブジェクト);
}
```

## プラグイン側からシステム変数へのアクセス

関数を定義したとき、プラグイン関数側からシステムにアクセスすることが必要な場合がある。
以下は、引数のない関数を定義した例だが、必ず、必要とされる引数の末尾に、実行したシステムのthisを保持するオブジェクトが渡される。
このオブジェクトを参照することで、システム変数にアクセスできる。

```
{
  type:"func", josi: [],
  fn:function (sys) {
    console.log(sys);
  }
}
```

## 初期化メソッド

以下のようなエントリを用意しておくと、プラグインを取り込み、初回実行する時に、初期化メソッドが実行される。(ただし、プラグイン取り込み時に、「!{プラグイン名}:初期化」というメソッド名にリネームされる。）

```
{
  "初期化": {
    type:"func", josi:[],
    fn: fuction (sys) { ... }
  }
  ...
}
```







